<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>IndicatorsChart</title>
</head>
<body>
  <h1>Hello World</h1>
  <div id="chartContainer"></div>
  <h1>Hello World</h1>
  <h1>Hello World</h1>
</body>
<!-- <script src="highcharts.js"></script>
<script src="exporting.js"></script> -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script>

  starter("AAPL", "Price");
  
  var sortCompareFn = function(obj1, obj2) {
      if (obj1[0] < obj2[0]) {
          return -1;
      } else if (obj1[0] > obj2[0]) {
          return 1;
      }
      return 0;
  }

  function starter(inputTicker, inputIndicator) {
    ticker = inputTicker;
    indicator = inputIndicator;
    loadIndicatorChart(ticker, indicator);
  }

  function loadIndicatorChart(ticker, indicator) {
    let url;
    if (indicator === "Price") {
      url = "http://ec2-18-221-164-179.us-east-2.compute.amazonaws.com/api/quote?symbol=" + ticker;
    } else {
      url = "http://ec2-18-221-164-179.us-east-2.compute.amazonaws.com/api/indicator?symbol=" + ticker + "&indicator=" + indicator;
    }
    fetch(url).then(function(response) {
      if (response.status !== 200) {
        return;
      }
      response.json().then(data => {
        if (data['Error Message']) {
          return;
        }
        drawChart(data, indicator, ticker);
      });
    });
  }

  function drawChart(data, indicator, ticker) {
    let options;
    if (indicator === 'Price') {
      const titleText = ticker + ' Stock Price and Volume';
      options = {
        chart: {
          zoomType: 'x'
        },
        title: {
          text: titleText
        },
        subtitle: {
          text: '<a target="_blank" style="color: blue" href="https://www.alphavantage.co">Source: Alpha Vantage</a>'
        },
        xAxis: {
          type: "datetime",
          labels: {
            format: '{value:%m/%d}'
          },
          units: [['week', [1]]],
          tickInterval: 2
        },
        legend: {
          layout: "horizontal",
          align: "center",
          verticalAlign: 'bottom',
        },
        yAxis: [{
          title: {
            text: "Stock Price"
          },
          min: data['quote']['minPrice'],
          max: data['quote']['maxPrice']
        }, {
          labels: {
            format: '{value}M'
          },
          title: {
            text: "Volume"
          },
          tooltip: {
            valueSuffix: 'M'
          },
          max: data['quote']['maxVolume'] * 4,
          opposite: true
        }],
        plotOptions: {
          series: {
            allowPointSelect: true
          },
          column: {
            pointWidth: 2,
          },
          area: {
            fillColor: "#E2E2FF"
          }
        },
        series: [{
          type: "area",
          name: "Price",
          data: data['priceSeries'].sort(sortCompareFn),
          color: "#0000FF"
        }, {
          type: "column",
          name: "Volume",
          yAxis: 1,
          data: data['volumeSeries'].sort(sortCompareFn),
          color: "#FF0000",
        }]
      };
    } else {
      options = {
        chart: {
          zoomType: 'x'
        },
        title: {
          text: data["meta"]["name"]
        },
        subtitle: {
          text: '<a target="_blank" style="color: blue" href="https://www.alphavantage.co">Source: Alpha Vantage</a>'
        },
        xAxis: {
          type: "datetime",
          labels: {
            format: '{value:%m/%d}'
          },
          units: [['week', [1]]],
          tickInterval: 2
        },
        legend: {
          layout: "horizontal",
          align: "center",
          verticalAlign: 'bottom'
        },
        yAxis: {
          title: {
            text: id
          }
        },
        plotOptions: {
          series: {
            marker: {
              enabled: false
            },
            lineWidth: 2,
            allowPointSelect: true
          }
        },
        series: data["series"]
      };
    }
    Highcharts.chart('chartContainer', options);
    // TODO (successfully load)
  }
</script>
</html>
